# Task Runner v1.0.4 Release Notes

**Release Date:** 25 January 2026
**Version:** 1.0.4  
**Status:** Enhancement Release  

## üéâ Overview

Task Runner v1.0.4 introduces environment variable expansion in command strings and working directory paths. This enhancement makes configurations more dynamic and reusable by allowing you to use environment variables directly in your commands and paths using `${VAR}` or `$VAR` syntax.

## ‚ú® Enhancements

### Environment Variable Expansion in Commands
- **Added**: Environment variables can now be expanded in command strings before execution
- **Impact**: Commands can now reference environment variables, making configurations more flexible and reusable
- **Syntax**: Supports both `${VAR}` and `$VAR` syntax patterns
- **Implementation**: 
  - Variables are expanded in command strings before execution
  - Expansion happens after all environment variables are merged (system ‚Üí global ‚Üí task-specific)
  - Works with all command types and shell commands

### Environment Variable Expansion in Working Directories
- **Added**: Environment variables can now be expanded in `working_dir` and `default_working_dir` paths
- **Impact**: Working directory paths can now be dynamic based on environment variables
- **Use Case**: Perfect for multi-environment setups where paths differ based on configuration
- **Implementation**: 
  - Variables are expanded in both task-specific `working_dir` and global `default_working_dir`
  - Expansion happens at task execution time, allowing dynamic path resolution

### Variable Expansion Order
- **Enhanced**: Clear precedence order for environment variable resolution
- **Order**: System environment variables ‚Üí Global config `env` ‚Üí Task-specific `env`
- **Impact**: Task-specific environment variables override global and system variables as expected

## üì¶ What's Included

This release includes:
- Environment variable expansion in command strings (`${VAR}` and `$VAR` syntax)
- Environment variable expansion in working directory paths
- Proper variable resolution order (system ‚Üí global ‚Üí task-specific)
- Updated documentation with examples
- All features and functionality from v1.0.3 remain unchanged

## üöÄ Installation

### From NPM
```bash
npm install -g task-runner@1.0.4
```

### From Source
```bash
git clone https://github.com/Zemerik/task-runner.git
cd task-runner
git checkout v1.0.4
cargo build --release
cargo install --path .
```

## üîÑ Upgrading from v1.0.3

No code changes required. Simply update to the new version:

```bash
npm install -g task-runner@1.0.4
```

Or rebuild from source if installing manually.

**Note**: If you have existing configurations that use literal `$` or `${` characters in commands or paths, they will now be interpreted as variable expansion. To use literal `$` characters, you may need to escape them or restructure your commands.

## üìã Compatibility

- **Backward Compatible**: Yes - fully compatible with v1.0.3
- **Configuration Files**: No changes required - existing configs work as before
- **API**: No breaking changes
- **Behavior Changes**: 
  - Commands and working directory paths now support environment variable expansion
  - Literal `$` characters in commands/paths will be interpreted as variable expansion (may require escaping)

## üß™ Testing

All existing tests pass. The enhancement ensures that:
- Environment variables are properly expanded in command strings
- Environment variables are properly expanded in working directory paths
- Variable resolution follows the correct precedence order
- Both `${VAR}` and `$VAR` syntax patterns work correctly
- Commands execute with expanded values

## üí° Example Usage

### Basic Variable Expansion in Commands

```json
{
  "env": {
    "NODE_ENV": "production",
    "PORT": "3000",
    "BUILD_DIR": "./dist"
  },
  "tasks": {
    "build": {
      "description": "Build with environment variables",
      "commands": [
        "npm run build -- --out-dir ${BUILD_DIR}",
        "echo Building for ${NODE_ENV} environment",
        "echo Server will run on port $PORT"
      ]
    }
  }
}
```

### Variable Expansion in Working Directories

```json
{
  "env": {
    "PROJECT_ROOT": "/home/user/project",
    "SOURCE_DIR": "src"
  },
  "default_working_dir": "${PROJECT_ROOT}/${SOURCE_DIR}",
  "tasks": {
    "compile": {
      "description": "Compile source files",
      "commands": ["tsc"],
      "working_dir": "${PROJECT_ROOT}/${SOURCE_DIR}/typescript"
    },
    "test": {
      "description": "Run tests",
      "commands": ["npm test"],
      "working_dir": "${PROJECT_ROOT}/tests"
    }
  }
}
```

### Multi-Environment Configuration

```yaml
env:
  ENV: development
  BUILD_DIR: ./build
  PORT: 3000

tasks:
  dev:
    description: Start development server
    commands:
      - "npm run dev -- --port ${PORT}"
      - "echo Starting ${ENV} server in ${BUILD_DIR}"
    env:
      NODE_ENV: development
    working_dir: "${BUILD_DIR}/dev"
    
  prod:
    description: Start production server
    commands:
      - "npm run start -- --port $PORT"
      - "echo Starting ${ENV} server"
    env:
      NODE_ENV: production
    working_dir: "${BUILD_DIR}/prod"
```

### Variable Precedence Example

```json
{
  "env": {
    "API_URL": "https://api.example.com",
    "TIMEOUT": "30"
  },
  "tasks": {
    "test": {
      "description": "Run tests with API configuration",
      "commands": [
        "npm test -- --api-url ${API_URL} --timeout ${TIMEOUT}"
      ],
      "env": {
        "TIMEOUT": "60"
      }
    }
  }
}
```

In this example:
- `API_URL` comes from global config: `https://api.example.com`
- `TIMEOUT` comes from task-specific env (overrides global): `60`

### Complex Path Expansion

```json
{
  "env": {
    "HOME": "/home/user",
    "PROJECT": "my-app",
    "VERSION": "1.0.0"
  },
  "tasks": {
    "deploy": {
      "description": "Deploy application",
      "commands": [
        "cp -r dist ${HOME}/deployments/${PROJECT}-${VERSION}",
        "ln -sf ${HOME}/deployments/${PROJECT}-${VERSION} ${HOME}/deployments/${PROJECT}-current"
      ],
      "working_dir": "${HOME}/projects/${PROJECT}"
    }
  }
}
```

## üîç Technical Details

### Supported Syntax
- `${VAR}` - Curly brace syntax (recommended for clarity)
- `$VAR` - Simple syntax (works but may conflict with adjacent characters)

### Expansion Scope
- **Commands**: All command strings are expanded before execution
- **Working Directories**: Both `working_dir` and `default_working_dir` are expanded
- **Environment Variables**: Variables in the `env` sections are not expanded (they are the source values)

### Variable Resolution
1. System environment variables (from `std::env::vars()`)
2. Global `env` from configuration file
3. Task-specific `env` (overrides previous values)

### Limitations
- Variable expansion is simple string replacement
- Nested variables (e.g., `${${VAR}}`) are not supported
- Variables that don't exist are replaced with empty strings
- No escaping mechanism for literal `$` characters (use alternative approaches if needed)

## üêõ Bug Fixes

None in this release.

## üìÑ License

MIT License - see [LICENSE](LICENSE) file for details.

## üôè Acknowledgments

Thank you to the community for feedback and continued support of the project.

## üìû Support

- **Documentation**: [README.md](README.md)
- **Issues**: [GitHub Issues](https://github.com/Zemerik/task-runner/issues)
- **Discussions**: [GitHub Discussions](https://github.com/Zemerik/task-runner/discussions)
- **Repository**: [https://github.com/Zemerik/task-runner](https://github.com/Zemerik/task-runner)

---

**Task Runner CLI v1.0.4** - Dynamic configurations with environment variable expansion.